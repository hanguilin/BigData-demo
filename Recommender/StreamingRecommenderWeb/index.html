<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>实时评分排行榜</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
</head>
<body>

    <div class="all">
        <h1>实时评分排行榜</h1>
        <span class="refresh-time">刷新时间：<span class="time-text"></span></span>
        <div class="product-table">
            <table>
                <thead>
                    <tr>
                        <th>商品名称</th>
                        <th>评分合计</th>
                    </tr>
                </thead>
                <tbody>

                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        let champion = '<svg t="1619600325685" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3793" width="25" height="25" fill="red"><path d="M657.212778 692.010817c198.527542-34.618449 302.065663-272.621051 302.065663-485.913878-63.067384 0-134.414339 0-162.91751 0 9.620102-68.769246 15.646352-124.139322 15.646352-143.373385-91.650373 0-506.526335 0-598.173638 0 3.317559 36.776601 7.833409 87.304392 14.016225 143.373385-28.79686 0-99.963713 0-163.856905 0 0 216.192877 104.930841 453.824019 307.677475 486.460324 32.152281 41.288358 56.08025 58.536184 83.363639 67.988464 0 19.120476 0 47.786353 0 47.786353L339.263355 808.332079l-86.837764 152.959717 520.990768 0L686.578596 808.333102 570.804802 808.333102l0-47.786353C595.832825 754.150062 628.084367 727.289298 657.212778 692.010817zM715.530998 598.039585c24.75173-57.706283 52.937676-207.106941 72.409147-334.572008 12.798491 0 32.917714 0 60.302411 0 0 179.800016-78.458933 313.974901-135.833665 341.376994C713.450616 602.567715 714.549647 600.293929 715.530998 598.039585zM175.243745 263.4686c26.479071 0 46.303582 0 59.31799 0 15.940041 128.166031 40.496319 269.923616 78.456886 341.55198C254.878456 578.178235 175.243745 443.267593 175.243745 263.4686zM399.837966 563.42216 399.837966 503.305991l75.555813 0L475.393779 271.492344l-77.660754 17.544585 0-61.98882 153.216567-32.280194L550.949592 503.305991l75.088162 0 0 60.117193L399.837966 563.423183z" p-id="3794"></path></svg>'
        let second = '<svg t="1619600129995" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2733" width="25" height="25" fill="green"><path d="M657.212778 692.010817c198.527542-34.618449 302.065663-272.621051 302.065663-485.913878-63.067384 0-134.414339 0-162.91751 0 9.620102-68.769246 15.646352-124.139322 15.646352-143.373385-91.650373 0-506.526335 0-598.173638 0 3.317559 36.776601 7.833409 87.304392 14.016225 143.373385-28.79686 0-99.963713 0-163.856905 0 0 216.192877 104.930841 453.824019 307.677475 486.460324 32.152281 41.288358 56.08025 58.536184 83.363639 67.988464 0 19.120476 0 47.786353 0 47.786353L339.263355 808.332079l-86.837764 152.959717 520.990768 0L686.578596 808.333102 570.804802 808.333102l0-47.786353C595.832825 754.150062 628.084367 727.289298 657.212778 692.010817zM715.530998 598.039585c24.75173-57.706283 52.937676-207.106941 72.409147-334.572008 12.798491 0 32.917714 0 60.302411 0 0 179.800016-78.458933 313.974901-135.833665 341.376994C713.450616 602.567715 714.549647 600.293929 715.530998 598.039585zM175.243745 263.4686c26.479071 0 46.303582 0 59.31799 0 15.940041 128.166031 40.496319 269.923616 78.456886 341.55198C254.878456 578.178235 175.243745 443.267593 175.243745 263.4686zM384.166031 563.42216l0-59.415204 104.093776-99.882871c21.831214-20.895913 37.112246-38.439474 45.848211-52.631708 8.730848-14.18814 13.099343-28.925796 13.099343-44.210921 0-34.462906-18.479887-51.696406-55.438637-51.696406-31.03483 0-61.053518 12.478196-90.059132 37.427424l0-67.134003c31.030737-20.584827 66.276473-30.877241 105.731066-30.877241 35.709293 0 64.012919 9.085936 84.912925 27.251667 20.894889 18.168802 31.344892 43.315528 31.344892 75.439156 0 42.419112-25.731034 86.86437-77.193103 133.332704l-75.555813 68.070328 0 1.403976 149.473313 0 0 62.924121L384.166031 563.423183z" p-id="2734"></path></svg>'
        let third = '<svg t="1619600162215" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3321" width="25" height="25" fill="blue"><path d="M657.212778 692.010817c198.527542-34.618449 302.065663-272.621051 302.065663-485.913878-63.067384 0-134.414339 0-162.91751 0 9.620102-68.769246 15.646352-124.139322 15.646352-143.373385-91.650373 0-506.526335 0-598.173638 0 3.317559 36.776601 7.833409 87.304392 14.016225 143.373385-28.79686 0-99.963713 0-163.856905 0 0 216.192877 104.930841 453.824019 307.677475 486.460324 32.152281 41.288358 56.08025 58.536184 83.363639 67.988464 0 19.120476 0 47.786353 0 47.786353L339.263355 808.332079l-86.837764 152.959717 520.990768 0L686.578596 808.333102 570.804802 808.333102l0-47.786353C595.832825 754.150062 628.084367 727.289298 657.212778 692.010817zM715.530998 598.039585c24.75173-57.706283 52.937676-207.106941 72.409147-334.572008 12.798491 0 32.917714 0 60.302411 0 0 179.800016-78.458933 313.974901-135.833665 341.376994C713.450616 602.567715 714.549647 600.293929 715.530998 598.039585zM175.243745 263.4686c26.479071 0 46.303582 0 59.31799 0 15.940041 128.166031 40.496319 269.923616 78.456886 341.55198C254.878456 578.178235 175.243745 443.267593 175.243745 263.4686zM483.814566 569.738006c-37.272905 0-67.291592-6.161327-90.058109-18.479887l0-66.666352c24.170492 18.092054 52.398394 27.13501 84.678588 27.13501 20.427238 0 36.644595-4.520967 48.654117-13.566994 12.006452-9.041934 18.012236-21.907962 18.012236-38.59604 0-17.152658-7.134491-30.252001-21.403472-39.298028-14.267958-9.041934-34.268478-13.566994-59.999512-13.566994l-32.280194 0 0-58.245566 29.707602 0c48.65514 0 72.983221-16.373922 72.983221-49.122791 0-30.877241-18.637476-46.315862-55.906288-46.315862-24.327058 0-47.953152 7.953136-70.877257 23.859407L407.325497 214.416418c24.949228-12.941753 54.345746-19.415189 88.187505-19.415189 34.305317 0 62.142316 7.916297 83.507926 23.74275 21.363564 15.829524 32.04688 37.777395 32.04688 65.847707 0 47.408753-24.016996 77.193103-72.046896 89.357144l0 1.169639c25.263383 2.806929 45.457308 12.046361 60.584843 27.719318 15.124466 15.671934 22.690792 34.736129 22.690792 57.192583 0 34.466999-12.595876 61.366649-37.778418 80.70202C559.33047 560.070832 525.762957 569.738006 483.814566 569.738006z" p-id="3322"></path></svg>'
        $(function(){
            initWebsocket()
        })
        function initWebsocket () {
            if ("WebSocket" in window)
            {
               // 打开一个 web socket
               var ws = new WebSocket("ws://192.168.1.43:7001/endpoint/business");
                
               ws.onopen = function()
               {
                  // Web Socket 已连接上，使用 send() 方法发送数据
                  ws.send("发送数据");
               };
                
               ws.onmessage = function (evt) 
               { 
                  var received_msg = evt.data;
                  consumer(received_msg)
               };
                
               ws.onclose = function()
               { 
                  // 关闭 websocket
               };
            }
            
            else
            {
               // 浏览器不支持 WebSocket
               alert("您的浏览器不支持 WebSocket!");
            }
        }

        function consumer (received_msg) {
            let html = JSON.parse(received_msg).sort((x, y) => {
                let val1 = x.split(',')[1]
                let val2 = y.split(',')[1]
                return val2 -val1
            }).map((e, i) => {
                let arr = e.split(',')
                let extra = getExtra(i)
                return `<tr><td>${extra}${arr[0]}</td><td>${arr[1]}</td></tr>`
            }).join('')
            $('.product-table tbody').html(html)
            $('.time-text').html(moment().format('YYYY/MM/DD HH:mm:ss'))
        }

        function getExtra (i) {
            switch (i) {
                case 0:
                    return champion
                case 1:
                    return second
                case 2:
                    return third
                default:
                    return ''
            }
        }
    </script>
</body>
</html>